<script type="text/javascript" src="//cdn.ometria.com/tags/spreetesting.js"></script>
<script type="text/javascript">
    if (ometria) {
      <% if controller_name == "home" %>
        ometria.init("homepage");
      <% elsif @product %>
        ometria.init("product",{
            "pid": "<%= @product.id %>";
        });
     <% elsif @taxon or @products %>
        var result = {}

        <% if @taxon %>
          result["category_id"] = "<%= @taxon.id %>";
        <% end %>

        <% if !params[:keywords].nil? %>
          result["search"] = "<%= params[:keywords] %>";
        <% end %>

        result["nitems"] = <%= @products.count %>;
        result["pids"] = [<%== @products.map { |p| '"' + p.id.to_s + '"' }.join(", ") %>];

        <% if params[:page].present? %>
          result["page"] = <%= params[:page] %>;
        <% end %>

        ometria.init("listing", result);
     <% elsif controller_name == "orders" %>
        <% if !params[:id].present? %>
          ometria.init("basket");
        <% end %>
     <% elsif controller_name == "checkout" %>
        ometria.init("checkout")
        <% if params[:state] == "address" %>
          ometria.trackCheckout(1);
        <% elsif params[:state] == "delivery" %>
          ometria.trackCheckout(2);
        <% elsif params[:state] == "payment" %>
          ometria.trackCheckout(3);
        <% elsif params[:state] == "confirm" %>
          ometria.trackCheckout(4);
        <% end %>
     <% else %>
        ometria.init(null);
     <% end %>
    }
</script>
